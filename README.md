# Malware Analysis

An E-book of malware analysis applications.You can download the programs used here from the applications folder.

Will be constantly updated...

# PAGES

1-)<a href="https://github.com/ysfcndgr/Malware-Analysis#zeus-botnet-memory-analysis">Zeus Botnet Memory Analysis</a>

2-)<a href="https://github.com/ysfcndgr/Malware-Analysis#stuxnet-memory-analysis">Stuxnet Memory Analysis</a>

3-)<a href="https://github.com/ysfcndgr/Malware-Analysis#darcomet-rat">Darcomet RAT Memory Analysis</a>




# Zeus Botnet Memory Analysis

We will analyze memory dump with Volatility.
We run the following command to find out from which system the image was taken.


<code>vol.exe -f zeus.vmem imageinfo </code>

![1](https://user-images.githubusercontent.com/32979760/111479163-c6087880-8741-11eb-9eac-0a1beae645ca.PNG)

Processes taken in the image are displayed with the following command.

<code>vol.exe -f zeus.vmem pstree</code>

![2](https://user-images.githubusercontent.com/32979760/111479933-7fffe480-8742-11eb-8156-49bdc874b55c.PNG)

There doesn't appear to be a problem with running processes.
We will check if there is a connection to the machine and if there is a connection to the machine, we will find out which process started via PiD.

<code>vol.exe -f zeus.vmem connscan</code>

![3](https://user-images.githubusercontent.com/32979760/111481066-a6724f80-8743-11eb-9ec0-9c92d5ed5f9e.PNG)

When we look at the screenshot above, we see that svchost.exe connects to the connection on port 80.This is not normal for svchost.exe.
(For more information on svchost.exe, see here. https://www.howtogeek.com/howto/windows-vista/what-is-svchostexe-and-why-is-it-running/ )

We continue

We check whether the address 193.104.41.75 is in the black list via ipvoid.com.

![4](https://user-images.githubusercontent.com/32979760/111482693-3369d880-8745-11eb-8d0f-5e9eab88b57b.PNG)

We see that the result is clean.


We check the ip address on the malwaredomain.com site.

![5](https://user-images.githubusercontent.com/32979760/111530822-d2f28f80-8774-11eb-8c6a-bc025803b9da.PNG)

It has been observed that the ip address is distributing malicious files and the description is zeus botnet.

Let's see if the malicious file runs itself at startup.

<code>vol.exe -f zeus.vmem printkey -K "Microsoft\Windows NT\CurrentVersion\Winlogon"</code>

![6](https://user-images.githubusercontent.com/32979760/111627005-ab94d480-87ff-11eb-82c5-07568f1521ce.PNG)

As seen in the screenshot, sdra64.exe runs itself automatically.

We are now looking for a malicious signature.

<code>vol.exe -f zeus.vmem malfind -D dump</code>

I saved the output under the dump folder.
We see svchost.exe in the output.

![7](https://user-images.githubusercontent.com/32979760/111628395-3aeeb780-8801-11eb-8e62-875012f8ab95.PNG)


Now with piD, the malware signature is saved under the dump folder

<code>vol.exe -f zeus.vmem malfind -D dump/ -p 856</code>

The output in the dump folder was scanned at virustotal.com.
and once again we see that the malware is Zbot.

![8](https://user-images.githubusercontent.com/32979760/111629784-b866f780-8802-11eb-884b-a994ccf8977b.PNG)


# Stuxnet Memory Analysis

What is stuxnet?


Stuxnet is worm software used by the US and Israel to disrupt Iran's nuclear operations. The virus, whose existence was revealed in June 2010, affected Iran's nuclear facilities in Bushehr and Natanz.
We are looking at image information


<code>  vol.exe -f stuxnet.vmem imageinfo</code> 

![9](https://user-images.githubusercontent.com/32979760/111703819-410b8500-884f-11eb-9be0-2a77d2d5ed05.PNG)

then we view the processes in the system.

<code>vol.exe -f stuxnet.vmem pslist</code>

![10](https://user-images.githubusercontent.com/32979760/111702483-60091780-884d-11eb-921e-0093ae01a330.PNG)
![11](https://user-images.githubusercontent.com/32979760/111702486-60a1ae00-884d-11eb-8b05-c1be4f3f90b9.PNG)

It is doubtful to have 3 identical lsass.exe processes.

<code> vol.exe -f stuxnet.vmem pstree </code>

We are viewing the start time of processes.

![12](https://user-images.githubusercontent.com/32979760/111703615-f853cc00-884e-11eb-9270-709e8a83c1b1.PNG)


The winlogon process must run in order to perform the login process in the Windows operating system.
We see that piD 680 and piD 624 start at the same time.
this appears normal, but other lsass.exe processes do not appear to be normal.piD(868, 1928)

Let's examine the network connections.

<code>vol.exe -f stuxnet.vmem connections</code>

![13](https://user-images.githubusercontent.com/32979760/111707479-2b995980-8855-11eb-8156-a06eda88b4e6.PNG)

no open network connections were seen.
We are examining the network sockets.

<code>vol.exe -f stuxnet.vmem sockets</code>

![14](https://user-images.githubusercontent.com/32979760/111707755-b11d0980-8855-11eb-8fc6-84411aebf20a.PNG)

It is normal for lsass.exe number piD 680 to broadcast from 500 and 4500 ports, but it isn't normal that the other 2 lsass.exe processes don't open ports.

<code>vol.exe -f stuxnet.vmem ldrmodules -p 1928 -v</code>

The dlls of the process piD 1928 have been seen.

![15](https://user-images.githubusercontent.com/32979760/111778187-5622fb00-88c5-11eb-9ad7-67c306a7f9c0.PNG)

As seen in the screenshot, kernel calls made are related to stuxnet.We are now looking for a malware signature.

<code> vol.exe -f stuxnet.vmem malfind -p 1928 -D dump </code>
 

![16](https://user-images.githubusercontent.com/32979760/111778563-e4977c80-88c5-11eb-8e29-57d2e6847905.PNG)

We go to virustotal.com and scan the results

![17](https://user-images.githubusercontent.com/32979760/111779204-e3b31a80-88c6-11eb-9ac3-1a385ec4b37c.PNG)
 
# Darcomet RAT

Download image: https://drive.google.com/file/d/0B-pKvSR-QbsHdDRzeG8xNVNnbEU/edit

As always, we first look at the image information.

<code>vol .exe -f WIN-TTUMF6EI3O3-20140203-123134.raw imageinfo </code>

![18](https://user-images.githubusercontent.com/32979760/111905356-45f15400-8a5c-11eb-8f4c-3e0e9a582194.PNG)

We see that the image is taken from the Windows 7 operating system.
Then the psxview parameter is executed to see the process list.

<code>vol .exe -f WIN-TTUMF6EI3O3-20140203-123134.raw --profile=Win7SP1x86 psxview </code>

![20](https://user-images.githubusercontent.com/32979760/111905605-8c937e00-8a5d-11eb-9a23-a7800f740c9c.PNG)

Looking carefully at the screenshot, the process that should be rundll32.exe is shown as runddl32.exe. This process is suspicious.
We need to examine the dll files that the process uses.

<code>vol .exe -f WIN-TTUMF6EI3O3-20140203-123134.raw --profile=Win7SP1x86 dlllist -p 1524 </code>

![1](https://user-images.githubusercontent.com/32979760/113492486-48ce5900-94e0-11eb-8c96-8f7f55e25206.PNG)

When we look at the file path that started the process, we can see that appdata is used.
We are deepening our research

<code>vol.exe -f WIN-TTUMF6EI3O3-20140203-123134.raw --profile=Win7SP1x86 dumpfiles -r runddl32 -D . </code>

![2](https://user-images.githubusercontent.com/32979760/113493031-b5e3ed80-94e4-11eb-91a5-0bc4c07ce150.PNG)

these files will be stored for review with the strings utility.
We continue to see if runddl32.exe starts other processes.

<code>vol.exe -f WIN-TTUMF6EI3O3-20140203-123134.raw --profile=Win7SP1x86 pstree</code>

![3](https://user-images.githubusercontent.com/32979760/113493106-43274200-94e5-11eb-865f-538a474b06c6.PNG)

After running 2 cmd as separate processes, it was seen that notepad.exe and runddl32.exe were running.
We use malfind parameter for notepad.exe

<code>vol.exe -f WIN-TTUMF6EI3O3-20140203-123134.raw --profile=Win7SP1x86 -p 1896 malfind</code>

<code> vol.exe -f WIN-TTUMF6EI3O3-20140203-123134.raw --profile=Win7SP1x86 memdump -p 1896 -D dumpfiles </code>

We will use the mutantscan parameter to find mutex objects in memory.

![4](https://user-images.githubusercontent.com/32979760/113493239-4111b300-94e6-11eb-894b-5864186c6e80.PNG)

We see that the malware is dc_mutex_khnew006.

Now we dump runddl32.exe continuation

Let's analyze the dump file with the strings tool.

![5](https://user-images.githubusercontent.com/32979760/113493709-98198700-94ea-11eb-8271-84da1cad1b5d.png)

As you can see, everything is clearly seen. ;)

Let's look at the startup

<code>vol.exe -f WIN-TTUMF6EI3O3-20140203-123134.raw --profile=Win7SP1x86 printkey -K "SOFTWARE\Microsoft\Windows\CurrentVersion\Run"</code>

![6](https://user-images.githubusercontent.com/32979760/113493822-8684af00-94eb-11eb-8904-27aad3b59c52.PNG)

the malware has been shown to run itself at startup and the analysis is over.



